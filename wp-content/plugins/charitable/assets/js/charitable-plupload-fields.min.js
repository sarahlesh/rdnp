/*!  1.4.9 2017-01-18 11:02 */
CHARITABLE=window.CHARITABLE||{},function(a,b){var c=function(b){var c=this,d=b.data("params"),e=new plupload.Uploader(d);this.$dragdrop=b,this.$dropzone=a(e.settings.drop_element),this.$images=a("#"+b.data("images")),this.$loader=this.$dragdrop.find(".charitable-drag-drop-image-loader").first(),this.max_file_uploads=d.multipart_params.max_uploads,this.max_file_size=parseInt(this.$dragdrop.data("max-size"),10),e.init(),e.bind("PostInit",function(){c.PostInit()}),e.bind("FilesAdded",function(a,b){c.FilesAdded(a,b)}),e.bind("Error",function(a,b){console.log(b)}),e.bind("FileUploaded",function(a,b,d){c.FileUploaded(a,b,d)})};c.prototype.PostInit=function(){var b=this;this.$dropzone&&(this.$dragdrop.parent().addClass("supports-drag-drop"),this.$dropzone.bind("dragover",function(){b.$dropzone.addClass("drag-over")}),this.$dropzone.bind("dragleave",function(){b.$dropzone.removeClass("drag-over")}),this.$dragdrop.on("click",".remove-image",function(){return b.remove_image(a(this))}))},c.prototype.FilesAdded=function(a,b){var c=this,d=this.$images.children().length;if(this.$dropzone.removeClass("drag-over"),this.max_file_uploads>0&&d+b.length>this.max_file_uploads){if(d<this.max_file_uploads){var e=this.max_file_uploads-d;a.splice(e-1,b.length-e),b=a.files}alert(msg)}this.max_file_uploads>0&&d+b.length>=this.max_file_uploads&&this.hide_dropzone(),plupload.each(b,function(b){c.add_image_loader(b),b.size>=c.max_file_size&&(a.removeFile(b),c.add_image_error(b,CHARITABLE_UPLOAD_VARS.max_file_size.replace("%1$s",b.name).replace("%2$s",c.bytes_to_mb(c.max_file_size))))}),a.refresh(),a.start()},c.prototype.FileUploaded=function(b,c,d){return d=a.parseJSON(d.response),d.success?(this.hide_image_loader(c),void this.$images.append(d.data)):void this.add_image_error(c,CHARITABLE_UPLOAD_VARS.upload_problem.replace("%s",c.name))},c.prototype.get_max_uploads_message=function(){var a=this.max_file_uploads>1?CHARITABLE_UPLOAD_VARS.max_file_uploads_plural:CHARITABLE_UPLOAD_VARS.max_file_uploads_single;return a.replace("%d",this.max_file_uploads)},c.prototype.add_image_loader=function(a){this.$loader.fadeIn(300),this.$loader.children(".images").append('<li data-file-id="'+a.id+'" class="">'+a.name+"</li>")},c.prototype.hide_image_loader=function(a){this.$loader.find("[data-file-id="+a.id+"]").remove(),this.$loader.find(".images li").length||this.$loader.hide()},c.prototype.remove_image=function(a){var b=a.parent();return b.fadeOut(300,function(){this.remove()}),this.$dropzone.fadeIn(300),!1},c.prototype.hide_dropzone=function(){this.$dropzone.removeClass("drag-over").fadeOut(300)},c.prototype.bytes_to_mb=function(a){var b=Math.floor(Math.log(a)/Math.log(1024));return 1*(a/Math.pow(1024,b)).toFixed(2)+" "+["B","kB","MB","GB","TB"][b]},c.prototype.add_image_error=function(a,b){var c=this;c.$dropzone.fadeIn(300),c.$loader.find("[data-file-id="+a.id+"]").addClass("error").text(b).delay(5e3).fadeOut(300,function(){c.hide_image_loader(a)})},b.Uploader=c,a(document).ready(function(){a(".charitable-drag-drop").each(function(){new c(a(this))})})}(jQuery,CHARITABLE);